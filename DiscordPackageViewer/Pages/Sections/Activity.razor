@page "/activity"
@inject PackageLoaderService Loader
@inject NavigationManager Nav
@inject ToastService Toast

<PageTitle>Activity â€” Discord Package Viewer</PageTitle>

<div class="content-header">ðŸ“ˆ Activity</div>
<div class="content-body">
    @if (Loader.Data?.ActivityEvents is { } events && events.Any())
    {
        <StatCardGrid Items="@events.Select(kv => new StatCardGrid.StatItem(kv.Key, kv.Value.Count.ToString("N0"), "events")).ToList()" />

        @foreach (var kv in events)
        {
            <ActivityEventTable Title="@kv.Key" Events="kv.Value" />
        }
    }
    else if (Loader.IsLoaded)
    {
        <p class="text-muted">No activity data found in the package. Activity files (analytics, reporting, tns) may be very large and take time to load.</p>
    }
</div>

@code {
    protected override void OnInitialized()
    {
        if (!Loader.IsLoaded)
        {
            Toast.Show("Please load a package first.", ToastLevel.Warning);
            Nav.NavigateTo("/");
        }
    }
}
