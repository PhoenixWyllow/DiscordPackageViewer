@page "/billing"
@inject PackageLoaderService Loader
@inject NavigationManager Nav
@inject ToastService Toast

<PageTitle>Billing â€” Discord Package Viewer</PageTitle>

<div class="content-header">ðŸ’³ Billing & Data Exports</div>
<div class="content-body">
    @if (Loader.Data is { } data && data.DataExports.Any())
    {
        <StatCardGrid Items="@data.DataExports.Select(e => new StatCardGrid.StatItem(e.Section, e.RecordCount.ToString(), "records")).ToList()" />

        @foreach (var export in data.DataExports.OrderBy(e => e.Section))
        {
            <BillingExportTable Export="export" />
        }

        <p class="text-muted" style="margin-top: 24px; font-size: 0.8125rem;">
            Generated at: @(data.DataExports.FirstOrDefault()?.GeneratedAt ?? "Unknown")
        </p>
    }
    else if (Loader.IsLoaded)
    {
        <p class="text-muted">No billing or export data found in the package.</p>
    }
</div>

@code {
    protected override void OnInitialized()
    {
        if (!Loader.IsLoaded)
        {
            Toast.Show("Please load a package first.", ToastLevel.Warning);
            Nav.NavigateTo("/");
        }
    }
}
