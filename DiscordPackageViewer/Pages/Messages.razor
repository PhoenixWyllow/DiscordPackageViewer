@page "/messages"
@inject PackageLoaderService Loader
@inject NavigationManager Nav
@inject ToastService Toast

<PageTitle>Messages â€” Discord Package Viewer</PageTitle>

@if (Loader.Data is { } data)
{
    <div class="messages-layout">
        <ChannelSidebar Channels="data.Channels"
                        SelectedChannelId="@_selectedChannelId"
                        OnChannelSelected="SelectChannel" />

        <div class="messages-main">
            <MessageView @ref="_messageView" Channel="@_selectedChannel" />
        </div>
    </div>
}

@code {
    private string? _selectedChannelId;
    private LoadedChannel? _selectedChannel;
    private MessageView? _messageView;

    protected override void OnInitialized()
    {
        if (!Loader.IsLoaded)
        {
            Toast.Show("Please load a package first.", ToastLevel.Warning);
            Nav.NavigateTo("/");
        }
    }

    private void SelectChannel(string channelId)
    {
        _selectedChannelId = channelId;
        _selectedChannel = Loader.Data?.Channels.GetValueOrDefault(channelId);
        _messageView?.ResetSearch();
    }
}
