@page "/servers"
@inject PackageLoaderService Loader
@inject NavigationManager Nav
@inject ToastService Toast

<PageTitle>Servers â€” Discord Package Viewer</PageTitle>

<div class="content-header">ğŸ  Servers</div>
<div class="content-body">
    @if (Loader.Data is { } data && data.Servers.Any() && selectedServer is null)
    {
        <ServerGrid Servers="data.Servers.Values.ToList()"
                    Title="@($"Your Servers ({data.Servers.Count})")"
                    ShowAuditCount="true"
                    OnSelect="s => selectedServer = s" />
    }
    else if (selectedServer is not null)
    {
        <ServerDetail Server="selectedServer" OnBack="() => selectedServer = null" />
    }
    else if (Loader.IsLoaded)
    {
        <p class="text-muted">No server data loaded.</p>
    }
</div>

@code {
    private LoadedServer? selectedServer;

    protected override void OnInitialized()
    {
        if (!Loader.IsLoaded)
        {
            Toast.Show("Please load a package first.", ToastLevel.Warning);
            Nav.NavigateTo("/");
        }
    }
}
